---
driver:
  name: vagrant

provisioner:
  name: chef_zero
  product_name: chef
  chef_license: accept-no-persist
  chef_version: <%= ENV['CHEF_VERSION'] || 'current' %>
  multiple_converge: 2
  enforce_idempotency: true
  deprecations_as_errors: true

verifier:
  name: inspec
  inspec_tests:
    - path: test/integration/inspec

platforms:
  - name: amazonlinux-2
  - name: centos-7
  - name: centos-8
  - name: centos-stream-8
  - name: fedora-latest

suites:
  - name: remi
    run_list:
      - recipe[yum-remi-chef::remi]
    verifier:
      controls:
        - remi
        - remi-safe

  - name: remi-test
    run_list:
      - recipe[yum-remi-chef::remi-test]
    attributes:
      yum:
        remi-test:
          enabled: true
          managed: true
    verifier:
      controls:
        - remi
        - remi-safe
        - remi-test

  - name: remi-php55
    run_list:
      - recipe[yum-remi-chef::remi-php55]
      - recipe[test::php]
    attributes:
      yum:
        remi-php55:
          enabled: true
          managed: true
      remi-test:
        version: '5.5'
    verifier:
      controls:
        - remi
        - remi-safe
        - php
      inputs:
        version: '5.5'
    exclude:
      - amazonlinux-2
      - centos-8
      - centos-stream-8
      - fedora-latest

  - name: remi-php56
    run_list:
      - recipe[yum-remi-chef::remi-php56]
      - recipe[test::php]
    attributes:
      yum:
        remi-php56:
          enabled: true
          managed: true
      remi-test:
        version: '5.6'
    verifier:
      controls:
        - remi
        - remi-safe
        - php
      inputs:
        version: '5.6'

  - name: remi-php70
    run_list:
      - recipe[yum-remi-chef::remi-php70]
      - recipe[test::php]
    attributes:
      yum:
        remi-php70:
          enabled: true
          managed: true
      remi-test:
        version: '7.0'
    verifier:
      controls:
        - remi
        - remi-safe
        - php
      inputs:
        version: '7.0'

  - name: remi-php71
    run_list:
      - recipe[yum-remi-chef::remi-php71]
      - recipe[test::php]
    attributes:
      yum:
        remi-php71:
          enabled: true
          managed: true
      remi-test:
        version: '7.1'
    verifier:
      controls:
        - remi
        - remi-safe
        - php
      inputs:
        version: '7.1'

  - name: remi-php72
    run_list:
      - recipe[yum-remi-chef::remi-php72]
      - recipe[test::php]
    attributes:
      yum:
        remi-php72:
          enabled: true
          managed: true
      remi-test:
        version: '7.2'
    verifier:
      controls:
        - remi
        - remi-safe
        - php
      inputs:
        version: '7.2'

  - name: remi-php73
    run_list:
      - recipe[yum-remi-chef::remi-php73]
      - recipe[test::php]
    attributes:
      yum:
        remi-php73:
          enabled: true
          managed: true
      remi-test:
        version: '7.3'
    verifier:
      controls:
        - remi-safe
        - php
      inputs:
        version: '7.3'

  - name: remi-php74
    run_list:
      - recipe[yum-remi-chef::remi-php74]
      - recipe[test::php]
    attributes:
      yum:
        remi-php74:
          enabled: true
          managed: true
      remi-test:
        version: '7.4'
    verifier:
      controls:
        - remi-safe
        - php
      inputs:
        version: '7.4'

  - name: remi-php80
    run_list:
      - recipe[yum-remi-chef::remi-php80]
      - recipe[test::php]
    attributes:
      yum:
        remi-php80:
          enabled: true
          managed: true
      remi-test:
        version: '8.0'
    verifier:
      controls:
        - remi-safe
        - php
      inputs:
        version: '8.0'
